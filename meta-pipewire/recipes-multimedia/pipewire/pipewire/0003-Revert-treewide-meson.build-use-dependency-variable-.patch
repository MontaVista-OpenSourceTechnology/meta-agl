From 8eda9c8d98d14dfc411e22c30e81fa32a5cb2f56 Mon Sep 17 00:00:00 2001
From: Ashok Sidipotu <ashok.sidipotu@collabora.com>
Date: Fri, 14 Jan 2022 18:23:54 +0530
Subject: [PATCH 03/12] Revert "treewide: meson.build: use dependency variable
 for SPA"

This reverts commit 2b110af36683f13f2b55064dec4ae02c1b407561.

Upstream-Status: Inappropriate[meson version dependent]
---
 spa/examples/meson.build             |  4 +-
 spa/meson.build                      | 42 ++++++-------
 spa/plugins/alsa/acp/meson.build     |  4 +-
 spa/plugins/alsa/meson.build         |  7 ++-
 spa/plugins/audioconvert/meson.build | 34 ++++++-----
 spa/plugins/audiomixer/meson.build   | 11 ++--
 spa/plugins/audiotestsrc/meson.build |  3 +-
 spa/plugins/bluez5/meson.build       | 24 ++++----
 spa/plugins/control/meson.build      |  3 +-
 spa/plugins/ffmpeg/meson.build       |  3 +-
 spa/plugins/jack/meson.build         |  3 +-
 spa/plugins/libcamera/meson.build    |  3 +-
 spa/plugins/support/meson.build      | 14 +++--
 spa/plugins/test/meson.build         |  3 +-
 spa/plugins/v4l2/meson.build         |  3 +-
 spa/plugins/videoconvert/meson.build |  3 +-
 spa/plugins/videotestsrc/meson.build |  3 +-
 spa/plugins/volume/meson.build       |  2 +-
 spa/plugins/vulkan/meson.build       |  3 +-
 spa/tests/meson.build                |  5 +-
 spa/tools/meson.build                |  9 ++-
 src/daemon/meson.build               |  8 +--
 src/gst/meson.build                  |  4 +-
 src/modules/meson.build              | 88 ++++++++++++++++------------
 src/modules/spa/meson.build          | 16 ++---
 src/pipewire/meson.build             |  4 +-
 test/meson.build                     | 11 +---
 27 files changed, 170 insertions(+), 147 deletions(-)

diff --git a/spa/examples/meson.build b/spa/examples/meson.build
index 7064a0643..bc04b723c 100644
--- a/spa/examples/meson.build
+++ b/spa/examples/meson.build
@@ -23,8 +23,8 @@ foreach c : spa_examples
     executable(
       c,
       c + '.c',
-      include_directories : [configinc],
-      dependencies : [spa_dep, dl_lib, pthread_lib, mathlib] + deps,
+      include_directories : [configinc, spa_inc],
+      dependencies : [dl_lib, pthread_lib, mathlib] + deps,
       install : installed_tests_enabled,
       install_dir : installed_tests_execdir / 'examples' / 'spa'
     )
diff --git a/spa/meson.build b/spa/meson.build
index 2404748df..2717b86d6 100644
--- a/spa/meson.build
+++ b/spa/meson.build
@@ -5,29 +5,7 @@
 #pthread_lib = dependencies('threads')
 #mathlib = cc.find_library('m', required : false)
 
-spa_dep = declare_dependency(
-  include_directories : [
-    include_directories('include'),
-  ],
-  dependencies : [atomic_dep],
-  version : spaversion,
-  variables : {
-    'plugindir' : meson.current_build_dir() / 'plugins',
-    'datadir' : meson.current_source_dir() / 'plugins',
-  },
-)
-
-meson.override_dependency('lib@0@'.format(spa_name), spa_dep)
-
-pkgconfig.generate(filebase : 'lib@0@'.format(spa_name),
-  name : 'libspa',
-  subdirs : spa_name,
-  description : 'Simple Plugin API',
-  version : spaversion,
-  extra_cflags : '-D_REENTRANT',
-  variables : ['plugindir=${libdir}/@0@'.format(spa_name)],
-  uninstalled_variables : ['plugindir=${prefix}/spa/plugins'],
-)
+spa_inc = include_directories('include')
 
 subdir('include')
 
@@ -77,3 +55,21 @@ subdir('tests')
 if not get_option('examples').disabled()
   subdir('examples')
 endif
+
+spa_dep = declare_dependency(
+  include_directories : [spa_inc],
+  version : spaversion,
+  variables : { 'plugindir' : meson.current_build_dir() / 'plugins' }
+)
+
+pkgconfig.generate(filebase : 'lib@0@'.format(spa_name),
+  name : 'libspa',
+  subdirs : spa_name,
+  description : 'Simple Plugin API',
+  version : spaversion,
+  extra_cflags : '-D_REENTRANT',
+  variables : ['plugindir=${libdir}/@0@'.format(spa_name)],
+  uninstalled_variables : ['plugindir=${prefix}/spa/plugins'],
+)
+
+meson.override_dependency('lib@0@'.format(spa_name), spa_dep)
diff --git a/spa/plugins/alsa/acp/meson.build b/spa/plugins/alsa/acp/meson.build
index 0ec97e2b4..3686aec82 100644
--- a/spa/plugins/alsa/acp/meson.build
+++ b/spa/plugins/alsa/acp/meson.build
@@ -16,7 +16,7 @@ acp_lib = static_library(
   'acp',
   acp_sources,
   c_args : acp_c_args,
-  include_directories : [configinc, includes_inc ],
-  dependencies : [ spa_dep, alsa_dep, mathlib, ]
+  include_directories : [configinc, spa_inc, includes_inc ],
+  dependencies : [ alsa_dep, mathlib, ]
   )
 acp_dep = declare_dependency(link_with: acp_lib)
diff --git a/spa/plugins/alsa/meson.build b/spa/plugins/alsa/meson.build
index e3fa6f0d7..402d93486 100644
--- a/spa/plugins/alsa/meson.build
+++ b/spa/plugins/alsa/meson.build
@@ -16,8 +16,8 @@ spa_alsa = shared_library(
   'spa-alsa',
   [ spa_alsa_sources ],
   c_args : acp_c_args,
-  include_directories : [configinc],
-  dependencies : [ spa_dep, alsa_dep, libudev_dep, mathlib, epoll_shim_dep, libinotify_dep ],
+  include_directories : [spa_inc, configinc],
+  dependencies : [ alsa_dep, libudev_dep, mathlib, epoll_shim_dep, libinotify_dep ],
   link_with : [ acp_lib ],
   install : true,
   install_dir : spa_plugindir / 'alsa'
@@ -30,7 +30,8 @@ alsa_udevrules = [
 executable('spa-acp-tool',
   [ 'acp-tool.c' ],
   c_args : acp_c_args,
-  dependencies : [ spa_dep, alsa_dep, mathlib, acp_dep ],
+  include_directories : [spa_inc ],
+  dependencies : [ alsa_dep, mathlib, acp_dep ],
   install : true,
 )
 
diff --git a/spa/plugins/audioconvert/meson.build b/spa/plugins/audioconvert/meson.build
index 89af12671..55e88ccc4 100644
--- a/spa/plugins/audioconvert/meson.build
+++ b/spa/plugins/audioconvert/meson.build
@@ -17,7 +17,7 @@ if have_sse
       'volume-ops-sse.c',
       'channelmix-ops-sse.c' ],
     c_args : [sse_args, '-O3', '-DHAVE_SSE'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_SSE']
@@ -27,7 +27,7 @@ if have_sse2
   audioconvert_sse2 = static_library('audioconvert_sse2',
     ['fmt-ops-sse2.c' ],
     c_args : [sse2_args, '-O3', '-DHAVE_SSE2'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_SSE2']
@@ -38,7 +38,7 @@ if have_ssse3
     ['fmt-ops-ssse3.c',
       'resample-native-ssse3.c' ],
     c_args : [ssse3_args, '-O3', '-DHAVE_SSSE3'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_SSSE3']
@@ -48,7 +48,7 @@ if have_sse41
   audioconvert_sse41 = static_library('audioconvert_sse41',
     ['fmt-ops-sse41.c'],
     c_args : [sse41_args, '-O3', '-DHAVE_SSE41'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_SSE41']
@@ -58,7 +58,7 @@ if have_avx and have_fma
   audioconvert_avx = static_library('audioconvert_avx',
     ['resample-native-avx.c'],
     c_args : [avx_args, fma_args, '-O3', '-DHAVE_AVX', '-DHAVE_FMA'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_AVX', '-DHAVE_FMA']
@@ -68,7 +68,7 @@ if have_avx2
   audioconvert_avx2 = static_library('audioconvert_avx2',
     ['fmt-ops-avx2.c'],
     c_args : [avx2_args, '-O3', '-DHAVE_AVX2'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_AVX2']
@@ -80,7 +80,7 @@ if have_neon
     ['resample-native-neon.c',
       'fmt-ops-neon.c' ],
     c_args : [neon_args, '-O3', '-DHAVE_NEON'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_NEON']
@@ -100,8 +100,7 @@ audioconvert_lib = static_library('audioconvert',
     'volume-ops-c.c' ],
   c_args : [ simd_cargs, '-O3'],
   link_with : simd_dependencies,
-  include_directories : [configinc],
-  dependencies : [ spa_dep ],
+  include_directories : [configinc, spa_inc],
   install : false
   )
 audioconvert_dep = declare_dependency(link_with: audioconvert_lib)
@@ -109,7 +108,8 @@ audioconvert_dep = declare_dependency(link_with: audioconvert_lib)
 spa_audioconvert_lib = shared_library('spa-audioconvert',
   audioconvert_sources,
   c_args : simd_cargs,
-  dependencies : [ spa_dep, mathlib, audioconvert_dep ],
+  include_directories : [spa_inc],
+  dependencies : [ mathlib, audioconvert_dep ],
   install : true,
   install_dir : spa_plugindir / 'audioconvert')
 spa_audioconvert_dep = declare_dependency(link_with: spa_audioconvert_lib)
@@ -117,7 +117,7 @@ spa_audioconvert_dep = declare_dependency(link_with: spa_audioconvert_lib)
 test_lib = static_library('test_lib',
   ['test-source.c' ],
   c_args : ['-O3'],
-  dependencies : [ spa_dep ],
+  include_directories : [spa_inc],
   install : false
   )
 
@@ -132,8 +132,8 @@ test_apps = [
 foreach a : test_apps
   test(a,
     executable(a, a + '.c',
-      dependencies : [ spa_dep, dl_lib, pthread_lib, mathlib, audioconvert_dep, spa_audioconvert_dep ],
-      include_directories : [ configinc ],
+      dependencies : [ dl_lib, pthread_lib, mathlib, audioconvert_dep, spa_audioconvert_dep ],
+      include_directories : [ configinc, spa_inc ],
       link_with : [ test_lib ],
       install_rpath : spa_plugindir / 'audioconvert',
       c_args : [ simd_cargs ],
@@ -163,8 +163,8 @@ benchmark_apps = [
 foreach a : benchmark_apps
   benchmark(a,
     executable(a, a + '.c',
-      dependencies : [ spa_dep, dl_lib, pthread_lib, mathlib, audioconvert_dep, spa_audioconvert_dep ],
-      include_directories : [ configinc ],
+      dependencies : [ dl_lib, pthread_lib, mathlib, audioconvert_dep, spa_audioconvert_dep ],
+      include_directories : [ configinc, spa_inc ],
       c_args : [ simd_cargs ],
       install_rpath : spa_plugindir / 'audioconvert',
       install : installed_tests_enabled,
@@ -191,8 +191,10 @@ if sndfile_dep.found()
     ]
   executable('spa-resample',
     sparesample_sources,
+    c_args : [ simd_cargs ],
+    include_directories : [spa_inc ],
     link_with : [ test_lib ],
-    dependencies : [ spa_dep, sndfile_dep, mathlib, audioconvert_dep ],
+    dependencies : [sndfile_dep, mathlib, audioconvert_dep],
     install : true,
     )
 endif
diff --git a/spa/plugins/audiomixer/meson.build b/spa/plugins/audiomixer/meson.build
index 9e1d12d59..214c2a887 100644
--- a/spa/plugins/audiomixer/meson.build
+++ b/spa/plugins/audiomixer/meson.build
@@ -11,7 +11,7 @@ simd_dependencies = []
 audiomixer_c = static_library('audiomixer_c',
   ['mix-ops-c.c' ],
   c_args : ['-O3'],
-  dependencies : [ spa_dep ],
+  include_directories : [spa_inc],
   install : false
 )
 simd_dependencies += audiomixer_c
@@ -20,7 +20,7 @@ if have_sse
   audiomixer_sse = static_library('audiomixer_sse',
     ['mix-ops-sse.c' ],
     c_args : [sse_args, '-O3', '-DHAVE_SSE'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
   )
   simd_cargs += ['-DHAVE_SSE']
@@ -30,7 +30,7 @@ if have_sse2
   audiomixer_sse2 = static_library('audiomixer_sse2',
     ['mix-ops-sse2.c' ],
     c_args : [sse2_args, '-O3', '-DHAVE_SSE2'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
   )
   simd_cargs += ['-DHAVE_SSE2']
@@ -40,7 +40,7 @@ if have_avx and have_fma
   audiomixer_avx = static_library('audiomixer_avx',
     ['mix-ops-avx.c'],
     c_args : [avx_args, fma_args, '-O3', '-DHAVE_AVX', '-DHAVE_FMA'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
   )
   simd_cargs += ['-DHAVE_AVX', '-DHAVE_FMA']
@@ -51,7 +51,8 @@ audiomixerlib = shared_library('spa-audiomixer',
   audiomixer_sources,
   c_args : simd_cargs,
   link_with : simd_dependencies,
-  dependencies : [ spa_dep, mathlib ],
+  include_directories : [spa_inc],
+  dependencies : [ mathlib ],
   install : true,
   install_dir : spa_plugindir / 'audiomixer'
 )
diff --git a/spa/plugins/audiotestsrc/meson.build b/spa/plugins/audiotestsrc/meson.build
index d1b22428d..8011ee883 100644
--- a/spa/plugins/audiotestsrc/meson.build
+++ b/spa/plugins/audiotestsrc/meson.build
@@ -2,6 +2,7 @@ audiotestsrc_sources = ['audiotestsrc.c', 'plugin.c']
 
 audiotestsrclib = shared_library('spa-audiotestsrc',
                           audiotestsrc_sources,
-                          dependencies : [ spa_dep, mathlib ],
+                          include_directories : [spa_inc],
+                          dependencies : [mathlib, ],
                           install : true,
                           install_dir : spa_plugindir / 'audiotestsrc')
diff --git a/spa/plugins/bluez5/meson.build b/spa/plugins/bluez5/meson.build
index 7a1e12ec7..ae6d8e8e0 100644
--- a/spa/plugins/bluez5/meson.build
+++ b/spa/plugins/bluez5/meson.build
@@ -51,8 +51,8 @@ endif
 
 bluez5lib = shared_library('spa-bluez5',
   bluez5_sources,
-  include_directories : [ configinc ],
-  dependencies : [ spa_dep, bluez5_deps ],
+  include_directories : [ spa_inc, configinc ],
+  dependencies : bluez5_deps,
   install : true,
   install_dir : spa_plugindir / 'bluez5')
 
@@ -60,26 +60,26 @@ codec_args = [ '-DCODEC_PLUGIN' ]
 
 bluez_codec_sbc = shared_library('spa-codec-bluez5-sbc',
   [ 'a2dp-codec-sbc.c', 'a2dp-codecs.c' ],
-  include_directories : [ configinc ],
+  include_directories : [ spa_inc, configinc ],
   c_args : codec_args,
-  dependencies : [ spa_dep, sbc_dep ],
+  dependencies : sbc_dep,
   install : true,
   install_dir : spa_plugindir / 'bluez5')
 
 bluez_codec_faststream = shared_library('spa-codec-bluez5-faststream',
   [ 'a2dp-codec-faststream.c', 'a2dp-codecs.c' ],
-  include_directories : [ configinc ],
+  include_directories : [ spa_inc, configinc ],
   c_args : codec_args,
-  dependencies : [ spa_dep, sbc_dep ],
+  dependencies : sbc_dep,
   install : true,
   install_dir : spa_plugindir / 'bluez5')
 
 if fdk_aac_dep.found()
   bluez_codec_aac = shared_library('spa-codec-bluez5-aac',
     [ 'a2dp-codec-aac.c', 'a2dp-codecs.c' ],
-    include_directories : [ configinc ],
+    include_directories : [ spa_inc, configinc ],
     c_args : codec_args,
-    dependencies : [ spa_dep, fdk_aac_dep ],
+    dependencies : fdk_aac_dep,
     install : true,
     install_dir : spa_plugindir / 'bluez5')
 endif
@@ -87,9 +87,9 @@ endif
 if aptx_dep.found()
   bluez_codec_aptx = shared_library('spa-codec-bluez5-aptx',
     [ 'a2dp-codec-aptx.c', 'a2dp-codecs.c' ],
-    include_directories : [ configinc ],
+    include_directories : [ spa_inc, configinc ],
     c_args : codec_args,
-    dependencies : [ spa_dep, aptx_dep, sbc_dep ],
+    dependencies : [ aptx_dep, sbc_dep ],
     install : true,
     install_dir : spa_plugindir / 'bluez5')
 endif
@@ -103,9 +103,9 @@ if ldac_dep.found()
   endif
   bluez_codec_ldac = shared_library('spa-codec-bluez5-ldac',
     [ 'a2dp-codec-ldac.c', 'a2dp-codecs.c' ],
-    include_directories : [ configinc ],
+    include_directories : [ spa_inc, configinc ],
     c_args : ldac_args,
-    dependencies : [ spa_dep, ldac_dep ],
+    dependencies : ldac_dep,
     install : true,
     install_dir : spa_plugindir / 'bluez5')
 endif
diff --git a/spa/plugins/control/meson.build b/spa/plugins/control/meson.build
index adabdfab3..10f9cfeda 100644
--- a/spa/plugins/control/meson.build
+++ b/spa/plugins/control/meson.build
@@ -5,6 +5,7 @@ control_sources = [
 
 controllib = shared_library('spa-control',
   control_sources,
-  dependencies : [ spa_dep, mathlib ],
+  include_directories : [spa_inc],
+  dependencies : [ mathlib ],
   install : true,
   install_dir : spa_plugindir / 'control')
diff --git a/spa/plugins/ffmpeg/meson.build b/spa/plugins/ffmpeg/meson.build
index 0e41ecb6e..2aec258da 100644
--- a/spa/plugins/ffmpeg/meson.build
+++ b/spa/plugins/ffmpeg/meson.build
@@ -4,6 +4,7 @@ ffmpeg_sources = ['ffmpeg.c',
 
 ffmpeglib = shared_library('spa-ffmpeg',
                           ffmpeg_sources,
-                          dependencies : [ spa_dep, avcodec_dep ],
+                          include_directories : [spa_inc],
+                          dependencies : [avcodec_dep],
                           install : true,
                           install_dir : spa_plugindir / 'ffmpeg')
diff --git a/spa/plugins/jack/meson.build b/spa/plugins/jack/meson.build
index 312a54061..b1732acd6 100644
--- a/spa/plugins/jack/meson.build
+++ b/spa/plugins/jack/meson.build
@@ -7,6 +7,7 @@ spa_jack_sources = [
 
 spa_jack = shared_library('spa-jack',
   spa_jack_sources,
-  dependencies : [ spa_dep, jack_dep, mathlib ],
+  include_directories : [spa_inc],
+  dependencies : [ jack_dep, mathlib ],
   install : true,
   install_dir : spa_plugindir / 'jack')
diff --git a/spa/plugins/libcamera/meson.build b/spa/plugins/libcamera/meson.build
index abb1a42cf..02ac2d9c2 100644
--- a/spa/plugins/libcamera/meson.build
+++ b/spa/plugins/libcamera/meson.build
@@ -11,7 +11,8 @@ summary({'libdrm': libdrm_dep.found()}, bool_yn: true, section: 'Backend')
 if libdrm_dep.found()
   libcameralib = shared_library('spa-libcamera',
     libcamera_sources,
-    dependencies : [ spa_dep, libudev_dep, libcamera_dep, pthread_lib, libdrm_dep  ],
+    include_directories : [ spa_inc ],
+    dependencies : [ libudev_dep, libcamera_dep, pthread_lib, libdrm_dep  ],
     install : true,
     install_dir : spa_plugindir / 'libcamera')
 endif
diff --git a/spa/plugins/support/meson.build b/spa/plugins/support/meson.build
index b810b283c..15010a51e 100644
--- a/spa/plugins/support/meson.build
+++ b/spa/plugins/support/meson.build
@@ -17,12 +17,14 @@ endif
 
 spa_support_lib = shared_library('spa-support',
   spa_support_sources,
+  include_directories : [ spa_inc ],
   c_args : [ simd_cargs ],
-  dependencies : [ spa_dep, pthread_lib, epoll_shim_dep ],
+  dependencies : [ pthread_lib, epoll_shim_dep ],
   install : true,
   install_dir : spa_plugindir / 'support')
 spa_support_dep = declare_dependency(link_with: spa_support_lib)
 
+
 if not get_option('evl').disabled()
   evl_inc = include_directories('/usr/evl/include')
   evl_lib = cc.find_library('evl',
@@ -33,8 +35,8 @@ if not get_option('evl').disabled()
 
   spa_evl_lib = shared_library('spa-evl',
     spa_evl_sources,
-    include_directories : [ evl_inc],
-    dependencies : [ spa_dep, pthread_lib, evl_lib ],
+    include_directories : [ spa_inc, evl_inc],
+    dependencies : [ pthread_lib, evl_lib],
     install : true,
     install_dir : spa_plugindir / 'support')
 endif
@@ -44,7 +46,8 @@ if dbus_dep.found()
 
   spa_dbus_lib = shared_library('spa-dbus',
     spa_dbus_sources,
-    dependencies : [ spa_dep, dbus_dep ],
+    include_directories : [ spa_inc],
+    dependencies : [dbus_dep, ],
     install : true,
     install_dir : spa_plugindir / 'support')
   spa_dbus_dep = declare_dependency(link_with: spa_dbus_lib)
@@ -61,7 +64,8 @@ if systemd_dep.found()
 
   spa_journal_lib = shared_library('spa-journal',
     spa_journal_sources,
-    dependencies : [ spa_dep, systemd_dep ],
+    include_directories : spa_inc,
+    dependencies : systemd_dep,
     install : true,
     install_dir : spa_plugindir / 'support')
   spa_journal_dep = declare_dependency(link_with: spa_journal_lib)
diff --git a/spa/plugins/test/meson.build b/spa/plugins/test/meson.build
index 950ee7c38..e824450f6 100644
--- a/spa/plugins/test/meson.build
+++ b/spa/plugins/test/meson.build
@@ -2,6 +2,7 @@ test_sources = ['fakesrc.c', 'fakesink.c', 'plugin.c']
 
 testlib = shared_library('spa-test',
                           test_sources,
-                          dependencies : [ spa_dep, pthread_lib ],
+                          include_directories : [ spa_inc],
+                          dependencies : [pthread_lib, ],
                           install : true,
                           install_dir : spa_plugindir / 'test')
diff --git a/spa/plugins/v4l2/meson.build b/spa/plugins/v4l2/meson.build
index 648583f32..297a62b16 100644
--- a/spa/plugins/v4l2/meson.build
+++ b/spa/plugins/v4l2/meson.build
@@ -5,6 +5,7 @@ v4l2_sources = ['v4l2.c',
 
 v4l2lib = shared_library('spa-v4l2',
                           v4l2_sources,
-                          dependencies : [ spa_dep, libudev_dep, libinotify_dep ],
+                          include_directories : [ spa_inc ],
+                          dependencies : [ libudev_dep, libinotify_dep ],
                           install : true,
                           install_dir : spa_plugindir / 'v4l2')
diff --git a/spa/plugins/videoconvert/meson.build b/spa/plugins/videoconvert/meson.build
index 24673a541..17d860d5a 100644
--- a/spa/plugins/videoconvert/meson.build
+++ b/spa/plugins/videoconvert/meson.build
@@ -9,7 +9,8 @@ simd_dependencies = []
 videoconvertlib = shared_library('spa-videoconvert',
   videoconvert_sources,
   c_args : simd_cargs,
-  dependencies : [ spa_dep, mathlib ],
+  include_directories : [spa_inc],
+  dependencies : [ mathlib ],
   link_with : simd_dependencies,
   install : true,
   install_dir : spa_plugindir / 'videoconvert')
diff --git a/spa/plugins/videotestsrc/meson.build b/spa/plugins/videotestsrc/meson.build
index 01a33ee29..f6f3dca56 100644
--- a/spa/plugins/videotestsrc/meson.build
+++ b/spa/plugins/videotestsrc/meson.build
@@ -2,6 +2,7 @@ videotestsrc_sources = ['videotestsrc.c', 'plugin.c']
 
 videotestsrclib = shared_library('spa-videotestsrc',
   videotestsrc_sources,
-  dependencies : [ spa_dep, pthread_lib ],
+  include_directories : [ spa_inc],
+  dependencies : [pthread_lib, ],
   install : true,
   install_dir : spa_plugindir / 'videotestsrc')
diff --git a/spa/plugins/volume/meson.build b/spa/plugins/volume/meson.build
index 2445e2bbd..e10f89563 100644
--- a/spa/plugins/volume/meson.build
+++ b/spa/plugins/volume/meson.build
@@ -2,6 +2,6 @@ volume_sources = ['volume.c', 'plugin.c']
 
 volumelib = shared_library('spa-volume',
   volume_sources,
-  dependencies : [ spa_dep ],
+  include_directories : [spa_inc],
   install : true,
   install_dir : spa_plugindir / 'volume')
diff --git a/spa/plugins/vulkan/meson.build b/spa/plugins/vulkan/meson.build
index b79bca2cf..9683b41ea 100644
--- a/spa/plugins/vulkan/meson.build
+++ b/spa/plugins/vulkan/meson.build
@@ -6,6 +6,7 @@ spa_vulkan_sources = [
 
 spa_vulkan = shared_library('spa-vulkan',
   spa_vulkan_sources,
-  dependencies : [ spa_dep, vulkan_dep, mathlib ],
+  include_directories : [spa_inc],
+  dependencies : [ vulkan_dep, mathlib ],
   install : true,
   install_dir : spa_plugindir / 'vulkan')
diff --git a/spa/tests/meson.build b/spa/tests/meson.build
index 9c78dcbd2..ea00a2cfe 100644
--- a/spa/tests/meson.build
+++ b/spa/tests/meson.build
@@ -21,7 +21,7 @@ if find.found()
                            })
       executable('spa-include-test-@0@'.format(spa_header.underscorify()),
                  src,
-                 dependencies: [ spa_dep ],
+                 include_directories: [spa_inc],
                  install: false)
     endif
   endforeach
@@ -36,7 +36,8 @@ benchmark_apps = [
 foreach a : benchmark_apps
   benchmark('spa-' + a,
     executable('spa-' + a, a + '.c',
-      dependencies : [ spa_dep, dl_lib, pthread_lib, mathlib ],
+      dependencies : [dl_lib, pthread_lib, mathlib ],
+      include_directories : [spa_inc ],
       install : installed_tests_enabled,
       install_dir : installed_tests_execdir,
     ),
diff --git a/spa/tools/meson.build b/spa/tools/meson.build
index 6f12e9c8f..e4df6c3ac 100644
--- a/spa/tools/meson.build
+++ b/spa/tools/meson.build
@@ -1,11 +1,14 @@
 executable('spa-inspect', 'spa-inspect.c',
-           dependencies : [ spa_dep, dl_lib ],
+           include_directories : [spa_inc],
+           dependencies : [dl_lib, ],
            install : true)
 
 executable('spa-monitor', 'spa-monitor.c',
-           dependencies : [ spa_dep, dl_lib ],
+           include_directories : [spa_inc],
+           dependencies : [dl_lib, ],
            install : true)
 
 executable('spa-json-dump', 'spa-json-dump.c',
-           dependencies : [ spa_dep, dl_lib, ],
+           include_directories : [spa_inc],
+           dependencies : [dl_lib, ],
            install : true)
diff --git a/src/daemon/meson.build b/src/daemon/meson.build
index 647d7393d..28cbe4467 100644
--- a/src/daemon/meson.build
+++ b/src/daemon/meson.build
@@ -87,16 +87,16 @@ pipewire_exec = executable('pipewire',
   pipewire_daemon_sources,
   install: true,
   c_args : pipewire_c_args,
-  include_directories : [ configinc ],
-  dependencies : [ spa_dep, pipewire_dep, ],
+  include_directories : [configinc, spa_inc],
+  dependencies : [pipewire_dep, ],
 )
 
 executable('pipewire-pulse',
   pipewire_daemon_sources,
   install: true,
   c_args : pipewire_c_args,
-  include_directories : [ configinc ],
-  dependencies : [ spa_dep, pipewire_dep, ],
+  include_directories : [configinc, spa_inc],
+  dependencies : [pipewire_dep, ],
 )
 
 ln = find_program('ln')
diff --git a/src/gst/meson.build b/src/gst/meson.build
index 709dc0f1c..b91b33dc9 100644
--- a/src/gst/meson.build
+++ b/src/gst/meson.build
@@ -24,8 +24,8 @@ pipewire_gst_headers = [
 
 pipewire_gst = shared_library('gstpipewire',
     pipewire_gst_sources,
-    include_directories : [ configinc ],
-    dependencies : [ spa_dep, gst_dep, pipewire_dep ],
+    include_directories : [configinc, spa_inc],
+    dependencies : [gst_dep, pipewire_dep],
     install : true,
     install_dir : '@0@/gstreamer-1.0'.format(get_option('libdir')),
 )
diff --git a/src/modules/meson.build b/src/modules/meson.build
index 2d3a800d3..ba30275ab 100644
--- a/src/modules/meson.build
+++ b/src/modules/meson.build
@@ -31,20 +31,20 @@ module_sources = [
 ]
 
 pipewire_module_access = shared_library('pipewire-module-access', [ 'module-access.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_loopback = shared_library('pipewire-module-loopback',
   [ 'module-loopback.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 simd_cargs = []
@@ -54,7 +54,7 @@ if have_sse
   pffft_sse = static_library('pffft_sse',
     ['module-filter-chain/pffft.c' ],
     c_args : [sse_args, '-O3', '-DHAVE_SSE'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_SSE']
@@ -64,7 +64,7 @@ if have_neon
   pffft_neon = static_library('pffft_neon',
     ['module-filter-chain/pffft.c' ],
     c_args : [neon_args, '-O3', '-DHAVE_NEON'],
-    dependencies : [ spa_dep ],
+    include_directories : [spa_inc],
     install : false
     )
   simd_cargs += ['-DHAVE_NEON']
@@ -74,7 +74,7 @@ endif
 pffft_c = static_library('pffft_c',
   ['module-filter-chain/pffft.c' ],
   c_args : [simd_cargs, '-O3', '-DPFFFT_SIMD_DISABLE'],
-  dependencies : [ spa_dep ],
+  include_directories : [spa_inc],
   install : false
 )
 simd_dependencies += pffft_c
@@ -100,7 +100,7 @@ endif
 
 pipewire_module_filter_chain = shared_library('pipewire-module-filter-chain',
   filter_chain_sources,
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -114,7 +114,7 @@ pipewire_module_echo_cancel_sources = [
 
 pipewire_module_echo_cancel = shared_library('pipewire-module-echo-cancel',
   pipewire_module_echo_cancel_sources,
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -124,26 +124,36 @@ pipewire_module_echo_cancel = shared_library('pipewire-module-echo-cancel',
 pipewire_module_profiler = shared_library('pipewire-module-profiler',
   [ 'module-profiler.c',
     'module-profiler/protocol-native.c', ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 build_module_rt = dbus_dep.found()
 if build_module_rt
 pipewire_module_rt = shared_library('pipewire-module-rt', [ 'module-rt.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
   dependencies : [dbus_dep, mathlib, dl_lib, pipewire_dep],
 )
+<<<<<<< HEAD
 # TODO: This serves as a temporary alias to prevent breaking existing setups
 #       while `module-rtkit` is being migrated to `module-rt`
 pipewire_module_rtkit = shared_library('pipewire-module-rtkit', [ 'module-rt.c' ],
   include_directories : [configinc],
+=======
+endif
+summary({'rt': build_module_rt}, bool_yn: true, section: 'Optional Modules')
+
+build_module_rtkit = dbus_dep.found()
+if build_module_rtkit
+pipewire_module_rtkit = shared_library('pipewire-module-rtkit', [ 'module-rtkit.c' ],
+  include_directories : [configinc, spa_inc],
+>>>>>>> Revert "treewide: meson.build: use dependency variable for SPA"
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -155,7 +165,7 @@ summary({'rt': build_module_rt}, bool_yn: true, section: 'Optional Modules')
 build_module_portal = dbus_dep.found()
 if build_module_portal
 pipewire_module_portal = shared_library('pipewire-module-portal', [ 'module-portal.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -169,20 +179,20 @@ pipewire_module_client_device = shared_library('pipewire-module-client-device',
     'module-client-device/resource-device.c',
     'module-client-device/proxy-device.c',
     'module-client-device/protocol-native.c', ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_link_factory = shared_library('pipewire-module-link-factory',
   [ 'module-link-factory.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_protocol_deps = [mathlib, dl_lib, pipewire_dep]
@@ -198,7 +208,7 @@ pipewire_module_protocol_native = shared_library('pipewire-module-protocol-nativ
     'module-protocol-native/protocol-native.c',
     'module-protocol-native/v0/protocol-native.c',
     'module-protocol-native/connection.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -273,7 +283,7 @@ endif
 
 pipewire_module_protocol_pulse = shared_library('pipewire-module-protocol-pulse',
   pipewire_module_protocol_pulse_sources,
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -285,7 +295,7 @@ if build_module_pulse_tunnel
   pipewire_module_pulse_tunnel = shared_library('pipewire-module-pulse-tunnel',
   [ 'module-pulse-tunnel.c',
     'module-protocol-pulse/format.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -296,7 +306,7 @@ summary({'pulse-tunnel': build_module_pulse_tunnel}, bool_yn: true, section: 'Op
 
 pipewire_module_protocol_simple = shared_library('pipewire-module-protocol-simple',
   [ 'module-protocol-simple.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -305,20 +315,20 @@ pipewire_module_protocol_simple = shared_library('pipewire-module-protocol-simpl
 
 pipewire_module_example_sink = shared_library('pipewire-module-example-sink',
   [ 'module-example-sink.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : false,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_example_sink = shared_library('pipewire-module-example-source',
   [ 'module-example-source.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : false,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_client_node = shared_library('pipewire-module-client-node',
@@ -330,12 +340,12 @@ pipewire_module_client_node = shared_library('pipewire-module-client-node',
     'module-client-node/v0/transport.c',
     'module-client-node/v0/protocol-native.c',
     'spa/spa-node.c', ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   link_with : pipewire_module_protocol_native,
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_metadata = shared_library('pipewire-module-metadata',
@@ -343,12 +353,12 @@ pipewire_module_metadata = shared_library('pipewire-module-metadata',
     'module-metadata/proxy-metadata.c',
     'module-metadata/metadata.c',
     'module-metadata/protocol-native.c'],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   link_with : pipewire_module_protocol_native,
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 test('pw-test-protocol-native',
@@ -356,8 +366,8 @@ test('pw-test-protocol-native',
     [ 'module-protocol-native/test-connection.c',
       'module-protocol-native/connection.c' ],
     c_args : libpipewire_c_args,
-    include_directories : [configinc ],
-    dependencies : [spa_dep, pipewire_dep],
+    include_directories : [configinc, spa_inc ],
+    dependencies : [pipewire_dep],
     install : installed_tests_enabled,
     install_dir : installed_tests_execdir,
   ),
@@ -383,7 +393,7 @@ pipewire_module_adapter = shared_library('pipewire-module-adapter',
   [ 'module-adapter.c',
     'module-adapter/adapter.c',
     'spa/spa-node.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -405,11 +415,11 @@ pipewire_module_session_manager = shared_library('pipewire-module-session-manage
     'module-session-manager/proxy-session-manager.c',
     'module-session-manager/session.c',
   ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 build_module_zeroconf_discover = avahi_dep.found()
@@ -418,7 +428,7 @@ pipewire_module_zeroconf_discover = shared_library('pipewire-module-zeroconf-dis
   [ 'module-zeroconf-discover.c',
     'module-protocol-pulse/format.c',
     'module-zeroconf-discover/avahi-poll.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -432,7 +442,7 @@ if build_module_raop_discover
 pipewire_module_raop_discover = shared_library('pipewire-module-raop-discover',
   [ 'module-raop-discover.c',
     'module-zeroconf-discover/avahi-poll.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -446,7 +456,7 @@ if build_module_raop
 pipewire_module_raop_sink = shared_library('pipewire-module-raop-sink',
   [ 'module-raop-sink.c',
     'module-raop/rtsp-client.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -462,7 +472,7 @@ build_module_roc = roc_lib.found()
 if build_module_roc
 pipewire_module_roc_sink = shared_library('pipewire-module-roc-sink',
   [ 'module-roc-sink.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
@@ -471,7 +481,7 @@ pipewire_module_roc_sink = shared_library('pipewire-module-roc-sink',
 
 pipewire_module_roc_source = shared_library('pipewire-module-roc-source',
   [ 'module-roc-source.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
   install_rpath: modules_install_dir,
diff --git a/src/modules/spa/meson.build b/src/modules/spa/meson.build
index 8332910b5..ab4fac18d 100644
--- a/src/modules/spa/meson.build
+++ b/src/modules/spa/meson.build
@@ -1,31 +1,31 @@
 pipewire_module_spa_node = shared_library('pipewire-module-spa-node',
   [ 'module-node.c', 'spa-node.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_spa_device = shared_library('pipewire-module-spa-device',
   [ 'module-device.c', 'spa-device.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_spa_node_factory = shared_library('pipewire-module-spa-node-factory',
   [ 'module-node-factory.c', 'spa-node.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
 
 pipewire_module_spa_device_factory = shared_library('pipewire-module-spa-device-factory',
   [ 'module-device-factory.c', 'spa-device.c' ],
-  include_directories : [configinc],
+  include_directories : [configinc, spa_inc],
   install : true,
   install_dir : modules_install_dir,
-  dependencies : [spa_dep, mathlib, dl_lib, pipewire_dep],
+  dependencies : [mathlib, dl_lib, pipewire_dep],
 )
diff --git a/src/pipewire/meson.build b/src/pipewire/meson.build
index 969f50b22..f66ce8746 100644
--- a/src/pipewire/meson.build
+++ b/src/pipewire/meson.build
@@ -103,9 +103,9 @@ libpipewire = shared_library(pipewire_name, pipewire_sources,
   version : libversion,
   soversion : soversion,
   c_args : libpipewire_c_args,
-  include_directories : [pipewire_inc, configinc, includes_inc],
+  include_directories : [pipewire_inc, configinc, spa_inc, includes_inc],
   install : true,
-  dependencies : [spa_dep, dl_lib, mathlib, pthread_lib, libintl_dep, atomic_dep, ],
+  dependencies : [dl_lib, mathlib, pthread_lib, libintl_dep, atomic_dep, ],
 )
 
 pipewire_dep = declare_dependency(link_with : libpipewire,
diff --git a/test/meson.build b/test/meson.build
index eca92eb24..4108ac14b 100644
--- a/test/meson.build
+++ b/test/meson.build
@@ -19,6 +19,7 @@ pwtest_c_args = [
 ]
 
 pwtest_inc = [
+  spa_inc,
   pipewire_inc,
   configinc,
   includes_inc,
@@ -36,7 +37,6 @@ test('test-pwtest',
     executable('test-pwtest',
                'test-pwtest.c',
                include_directories: pwtest_inc,
-               dependencies: [ spa_dep ],
                link_with: pwtest_lib)
 )
 
@@ -45,7 +45,6 @@ test('test-pwtest',
 executable('test-example',
   'test-example.c',
   include_directories: pwtest_inc,
-  dependencies: [ spa_dep ],
   link_with: pwtest_lib)
 
 test('test-pw-utils',
@@ -55,7 +54,6 @@ test('test-pw-utils',
                'test-map.c',
                'test-utils.c',
                include_directories: pwtest_inc,
-               dependencies: [ spa_dep ],
                link_with: pwtest_lib)
 )
 
@@ -63,7 +61,6 @@ test('test-lib',
     executable('test-lib',
                'test-lib.c',
                include_directories: pwtest_inc,
-               dependencies: [ spa_dep ],
                link_with: pwtest_lib)
 )
 
@@ -71,7 +68,6 @@ test('test-client',
     executable('test-client',
                'test-client.c',
                include_directories: pwtest_inc,
-               dependencies: [ spa_dep ],
                link_with: pwtest_lib)
 )
 
@@ -88,7 +84,7 @@ test('test-context',
                'test-context.c',
                'test-config.c',
                include_directories: pwtest_inc,
-               dependencies: [spa_dep, spa_support_dep, spa_dbus_dep],
+               dependencies: [spa_support_dep, spa_dbus_dep],
                link_with: [pwtest_lib,
                             pipewire_module_protocol_native,
                             pipewire_module_client_node,
@@ -103,7 +99,7 @@ test('test-support',
                'test-support.c',
                'test-logger.c',
                include_directories: pwtest_inc,
-               dependencies: [spa_dep, systemd_dep, spa_support_dep, spa_journal_dep],
+               dependencies: [systemd_dep, spa_support_dep, spa_journal_dep],
                link_with: [pwtest_lib])
 )
 test('test-spa',
@@ -115,7 +111,6 @@ test('test-spa',
                'test-spa-node.c',
                'test-spa-pod.c',
                include_directories: pwtest_inc,
-               dependencies: [ spa_dep ],
                link_with: pwtest_lib)
 )
 
-- 
2.35.1

