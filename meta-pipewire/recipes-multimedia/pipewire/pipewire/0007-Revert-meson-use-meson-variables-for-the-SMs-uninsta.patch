From 4e8241675e68d5fb082d42ff597e681955eabbc4 Mon Sep 17 00:00:00 2001
From: Ashok Sidipotu <ashok.sidipotu@collabora.com>
Date: Thu, 24 Feb 2022 12:37:27 +0530
Subject: [PATCH 07/12] Revert "meson: use meson variables for the SMs'
 uninstalled scripts"

This reverts commit d5825b8551c34cefabf278a6b5ed04bc6ab0f301.
Upstream-Status: Inappropriate[meson version dependent]
---
 src/daemon/meson.build | 16 ++++++++++------
 1 file changed, 10 insertions(+), 6 deletions(-)

diff --git a/src/daemon/meson.build b/src/daemon/meson.build
index 28cbe4467..cd17d23c3 100644
--- a/src/daemon/meson.build
+++ b/src/daemon/meson.build
@@ -46,17 +46,21 @@ elif default_sm == 'media-session'
   ms_bindir = ms_proj.get_variable('media_session_bin_dir', pipewire_bindir)
   conf_config.set('session_manager_path', ms_bindir / 'pipewire-media-session')
 
-  ms_uninstalled = ms_proj.get_variable('media_session_uninstalled')
-  conf_config_uninstalled.set('session_manager_path', ms_uninstalled.full_path())
-  conf_config_uninstalled.set('session_manager_args', 'pipewire-media-session')
+  conf_config_uninstalled.set('session_manager_path',
+    meson.source_root() / 'subprojects' / 'media-session' / 'media-session-uninstalled.sh')
+  conf_config_uninstalled.set('session_manager_args',
+    '-b ' + meson.build_root() / 'subprojects' / 'media-session' + ' pipewire-media-session')
   conf_config_uninstalled.set('sm_comment', '')
 elif default_sm == 'wireplumber'
   wp_bindir = wp_proj.get_variable('wireplumber_bin_dir', pipewire_bindir)
+
   conf_config.set('session_manager_path', wp_bindir / 'wireplumber')
 
-  wp_uninstalled = wp_proj.get_variable('wireplumber_uninstalled')
-  conf_config_uninstalled.set('session_manager_path', wp_uninstalled.full_path())
-  conf_config_uninstalled.set('session_manager_args', 'wireplumber')
+  # wp-uninstalled.sh -b path/to/wp/build/root wireplumber
+  conf_config_uninstalled.set('session_manager_path',
+    meson.source_root() / 'subprojects' / 'wireplumber' / 'wp-uninstalled.sh')
+  conf_config_uninstalled.set('session_manager_args',
+    '-b ' + meson.build_root() / 'subprojects' / 'wireplumber' + ' wireplumber')
   conf_config_uninstalled.set('sm_comment', '')
 else
   conf_config_uninstalled.set('session_manager_path', default_sm)
-- 
2.35.1

